---
main_topsize: 0.2 #percent coverage of the poster
main_bottomsize: 0.1
primary_colour: "#2596be"
secondary_colour: "#648db5"
accent_colour: "#937543"


#ESSENTIALS
title: '**BPSTAT: PESQUISA 2.0**'
author:
  - name: '**![](shiny.png)[yabstat.shinyapps.io/bportugal](https://yabstat-teste.shinyapps.io/shiny_bportugal_mongo/)**'
   # affil: 1
    main: true
   # orcid: '0000-0002-1099-3857'
  
    #email: halsa@iscte-iul.pt
  - name: '**![](GitHub.png)[github.com/NCdJ/yabpstat](https://github.com/NCdJ/yabpstat)**'
  #   affil: 2
    main: true
  #   email: 'ag.con@posterdown.net'
  - name: Henrique Luís
    affil: 1
  - name: Maria Ribeiro
    affil: 2
  - name: Nelson Jesus
    affil: 3
  - name: Pedro Ferreira
    affil: 4
  - name: Telma Garção
    affil: 5
affiliation:
  - num: 1
    address: halsa ![](atr.jpg)iscte-iul.pt; Licenciatura Ciência de Dados, ISCTE-IUL
  - num: 2
    address: mcroo2 ![](atr.jpg)iscte-iul.pt; Licenciatura Ciência de Dados, ISCTE-IUL
  - num: 3
    address: nelson_carvalho_jesus ![](atr.jpg)iscte-iul.pt; Licenciatura Ciência de Dados, ISCTE-IUL
  - num: 4
    address: pvfaa ![](atr.jpg)iscte-iul.pt; Licenciatura Ciência de Dados, ISCTE-IUL
  - num: 3
    address: telma_garcao ![](atr.jpg)iscte-iul.pt; Licenciatura Ciência de Dados, ISCTE-IUL
  
main_findings:
  - "**É POSSÍVEL ENCONTRAR UMA AGULHA NUM PALHEIRO?**<br>
          <br>
          ![](iscte.png)"
logoleft_name: https&#58;//raw.githubusercontent.com/TelmaG/posterdown/main/Meu%20projeto.png
logoright_name: https&#58;//raw.githubusercontent.com/TelmaG/posterdown/main/Meu%20projeto.png
logocenter_name: https&#58;//raw.githubusercontent.com/TelmaG/posterdown/main/My_Video_Page.png
output: 
  posterdown::posterdown_betterport:
    self_contained: false
    pandoc_args: --mathjax
    number_sections: false
bibliography: packages.bib
link-citations: true
lang: pt
knit: pagedown::chrome_print
---


```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      tidy = FALSE,
                      message = FALSE,
                      fig.align = 'center',
                      out.width = "100%")
options(knitr.table.format = "html") 
```


```{r, fig.width=8, fig.height=1, fig.align='left'}
library(tidyverse)
library(ggplot2)
df <- tibble(L =  c("R","CSS","Javascript"), 
                   Proportion = c(85,8.2, 6.8))
df$L <- factor(df$L, levels = rev(as.character(df$L)))
g <- ggplot(df, aes(x = "", y = Proportion, fill = L)) +
       geom_col() +
       geom_text(aes(label = paste0(Proportion, "%")), 
                     position = position_stack(vjust = 0.5)) +
    guides(fill = guide_legend(reverse = TRUE))+labs(x = NULL, y = NULL, fill = NULL, title = NULL) +
      scale_fill_manual(values=c("#999999", "#F6AE2D", "#2596be"))  +
       theme_minimal() + theme_classic()+ theme(axis.line = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank())
g <-g+coord_flip()
g
```




## Introdução

No BPstat, o Banco de Portugal divulga um vasto conjunto de estatísticas sobre a economia portuguesa e da área euro, que podem ser consultadas por domínios (`BPstat > Domínios`), exploradas de forma personalizada (`BPstat > Dados > Exploração Livre`) ou exploradas com recurso a séries e quadros pré-definidos (`BPstat > Dados > Exploração em Árvore`). Com mais de 270 mil séries à disposição, os utilizadores podem ainda fazer uso da pesquisa exclusiva, isto é, o acesso ao conteúdo é feito através de uma *query* na barra de navegação. 
O desafio insere-se num problema de ***information retrieval***. 


```{r, include=FALSE}
knitr::write_bib(c('posterdown', 'rmarkdown','pagedown'), 'packages.bib')
```

### Objetivos

Os objetivos estão dirigidos à pesquisa exclusiva e ao refinamento das queries. 

1.  Pluralização
2.  *Stemming*
3.  Expansão por sinónimos
4.  Lógica axiomática
5.  Pesquisa avançada
6.  *Autocomplete*

## Metodologia


A abordagem ao desafio implica compreender como a informação está organizada. Os dados encontram-se estruturados no BPstat, contudo as *queries* podem retornar informação não relevante para os utilizadores. A primeira fase de testes identifica a oportunidade de mapear termos procurados com frequência a sinónimos e palavras relacionadas. 
As séries estatísticas são recolhidas através da API do Banco de Portugal, em formato JSON, e carregadas num *cluster* do MongoDB Atlas. 

As diferentes fases do projeto utilizam várias técnicas.

* Tokenização
* Webscraping
* ETL - Extract, Transform & Load

A prova de conceito pode ser descrita pelo fluxograma:

```{r chunk, echo=FALSE, fig.cap='Visão geral do projeto', fig.cap.style="Figura", fig.height=6, out.width="80%"}
library(tidyverse)
knitr::include_graphics("images/prova.jpeg")

```



### Produtos Intermédios

* Dicionário de sinónimos
* *Thesaurus*
* REST API


## Data Science

* *Forecasting* com séries temporais
* TF-IDF

A funcionalidade de FTS (*Full-Text Search*) no MongoDB Atlas recorre ao scoring do Apache Lucene, que tem por base o Vector Space Model. Perante uma query do utilizador, é determinado o grau de relevância face à totalidade de documentos. 
Cada documento, **$d_{j}$**, e a query, **$q$**, são tratados como vectores e a similaridade por cosseno é calculada. 


$$
\cos (d_{j}, q) =\frac{d_{j}\times q}{\left \| d_{j} \right \|\cdot \left \| q \right \|}
$$

```{r results = 'asis', echo=FALSE, tab.cap='Scoring da query «euribor 3M»', fig.height=2, out.width="100%"}

library(flextable)
library(reactable)
library(kableExtra)
score <-read.csv('score.csv', encoding = 'latin1', check.names=FALSE)
#flextable(score)
#reactable(score)
endpoints_table <- knitr::kable(score,col.names=gsub(" 
                   [.]"," ",names(score)), align="l", 
                   caption = "Scoring da query «euribor 3M»")


# kable_styling(endpoints_table,latex_options="scale_down",
#               "condensed") %>%
#  row_spec(0,bold=F)
color.me <- which(score$Score >0.5)

kable_classic_2(endpoints_table, full_width = F, html_font = "Rasa") %>%
row_spec(color.me, bold = F, color = "black", background = "#E5E4E2")
# column_spec(1, bold = F, border_right = T) %>%
# column_spec(2, width = "30em", background = "yellow")

```
<br>
A métrica **tf-idf** faz corresponder ao termo *t* um peso no documento *d*. Seja $tf_{t,d}$ o *term frequency* e $idf_{t}$ o *inverse document frequency* :


$$
tf\; idf_{t,d} = tf_{t,d}\times idf_{t}
$$
O cálculo do **tf-idf** do termo `empresas`, por documento, permite identificar `Empresas da central de balanços` como o domínio onde o termo tem maior relevância.

```{r chunk2, echo=FALSE, fig.cap='Domínios por grau de relevância do termo «empresas»', fig.cap.style="Figura", fig.height=6, out.width="80%"}
knitr::include_graphics("images/plot.PNG")
```


<br>

## Produtos Finais

Foram desenvolvidos dois produtos finais. 


### Aplicação Shiny

Interface gráfica para pesquisa de séries.



```{r chunk3, echo=FALSE, fig.cap='Versão em shiny do BPstat', fig.cap.style="Figura", fig.height=14, out.width="100%"}

knitr::include_graphics("images/shiny.PNG")

```


### Package 

Construído em R, permite aceder às séries estatísticas através da *BPstat Data API*.

* Designação: <span style="color:#2596be">**YABPstat: Yet Another BPstat**</span>
* Versão: 0.0.0.9000
* Licença: MIT

***INSTALAÇÃO***


```{r echo = T, results = 'hide'}

# install.packages("devtools")
library(devtools)
devtools::install_github("NCdJ/yabpstat")
library(yabpstat)

```


## Agradecimentos

Ao Professor José Dias e ao Professor Jorge Sinval por nos terem auxiliado a ultrapassar os obstáculos com que nos deparámos ao longo deste projeto e a transformá-los, assim, em oportunidades. 

