# WARNING - Generated by {fusen} from dev/flat_full.Rmd: do not edit by hand

#' Title: generate_datasets()
#' 
#' Description: This is an helper function that given an href from a BPstat dataset, it returns a dataframe with the follow information: version, href, class, source
#' 
#' @importFrom httr2 request
#' @importFrom httr2 req_user_agent
#' @importFrom httr2 req_perform
#' @importFrom jsonlite fromJSON
#' @importFrom jsonlite flatten
#' @importFrom dplyr mutate
#' @importFrom dplyr %>%
#' 
#' @return A dataframe with information about datasets, namely: version, href, class, source
#' 
#' @noRd
#' 
#' @examples
#' \dontrun{
#' generate_datasets()
#' }
generate_datasets <- function(dataset_href){

  max_datasets <- 100
  
  url <- paste0(dataset_href, "&page_size=", max_datasets)
  
  response <- httr2::request(url) %>%
    httr2::req_user_agent("YABPstat package") %>% 
    httr2::req_perform()
  
  content_df <- response %>% 
    httr2::resp_body_raw() %>% 
    rawToChar() %>% 
    jsonlite::fromJSON()

  datasets_df <- jsonlite::flatten(content_df$link$item)
  
  datasets_df <- datasets_df %>% 
    dplyr::mutate(version = content_df$version,
                  href = content_df$href,
                  class = content_df$class,
                  source = content_df$source)
  
  return(datasets_df)
  
}
